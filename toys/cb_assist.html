<!DOCTYPE html>
<html>
<head>
    <title>CB Assistant</title>
    <style>
        body {
            background: black;
            color: white;
            margin-left: 1rem;
            margin-right: 1rem;
            user-select: none;
        }

        #container {
            float: left;
        }

        #directions {
            float: right;
            width: 50%;
        }

        #help {
            float: right;
            display: none;
            width: 10%;
            margin-right: 23%;
            font-size: 11rem;
            text-align: center;
            text-shadow: 0.8px 1.3px 2px silver;
            color: black;
        }

        #help:hover {
            color: white;
        }

        .up {
            margin-bottom: 1.5rem;
        }

        .down {
            margin-top: 1.5rem;
        }

        .up, .down {
            margin-left: 0.25rem;
            margin-right: 0.25rem;
            display: inline-block;
        }

        .left {
            margin-left: 0.75rem;
            margin-right: 1.25rem;
            display: inline-block;
        }

        .right {
            margin-left: 1.25rem;
            margin-right: 0.75rem;
            display: inline-block;
        }

        .row {
            padding: 0.5rem;
            border: 1px solid silver;
            width: 16rem;
            height: 3rem;
        }

        .score {
            float: right;
        }

        .correct, .incorrect {
            font-weight: bold;
            font-size: 1.5rem;
            text-align: center;
            width: 1.5rem;
            height: 1.5rem;
        }

        .correct {
            border: 1px solid green;
            margin-top: -0.2rem;
        }

        .incorrect {
            border: 1px solid red;
            margin-top: 0.2rem;
        }

        /*
         * https://css-tricks.com/snippets/css/css-triangle/
         */

        .up {
            width: 0; 
            height: 0; 
            border-left: 1.5rem solid transparent;
            border-right: 1.5rem solid transparent;

            border-bottom: 1.5rem solid yellow;
        }

        .down {
            width: 0; 
            height: 0; 
            border-left: 1.5rem solid transparent;
            border-right: 1.5rem solid transparent;

            border-top: 1.5rem solid yellow;
        }

        .left {
            width: 0; 
            height: 0; 
            border-top: 1.5rem solid transparent;
            border-bottom: 1.5rem solid transparent;

            border-right: 1.5rem solid blue;
        }

        .right {
            width: 0; 
            height: 0; 
            border-top: 1.5rem solid transparent;
            border-bottom: 1.5rem solid transparent;

            border-left: 1.5rem solid blue;
        }

        #statusBar {
            width: 98%;
        }

        #status {
            resize: none;
            overflow: hidden;
            background: black;
            color: white;
            width: 100%;
            height: 2.6rem;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="statusBar">
            <textarea id="status" placeholder="Status" readOnly="true" onfocus="this.blur()" rows="4"></textarea>
        </div>

        <div class="row">
            <span class="score">
                <div class="correct selected">0</div>
                <div class="incorrect">0</div>
            </span>
        </div>
    </div>

    <div id="directions" onclick="helpMe()">
        <p>WASD or arrow keys - Add up to 4 arrows to a row. When full, the final arrow will change instead.</p>
        <p>Q or Backspace will remove the last arrow from the current row.</p>
        <p>Use Enter or E to add a new row.</p>
        <p>Use R or Ctrl + Backspace to remove a row</p>
        <p>Use F or refresh the page to reset.</p>
        <p>Press a number 0-4 to set the currently-selected score (correct, incorrect) for the current row.</p>
        <p>The number 5 can be used instead of 0.</p>
        <p>Press C to change the highlighted score for the current row.</p>
        <p>Click on this text to hide it.</p>
    </div>

    <div id="help" onclick="helpMe()">?</b>
    </div>
<script>
    function setStatus (t) {
        const s = document.getElementById('status')

        if (s.value !== '') {
            s.value += '\n' + t
        } else {
            s.value = t
        }

        s.scrollTop = s.scrollHeight
    }

    function addRow () {
        const l = Array.from(document.querySelectorAll('.row'))
            .slice(-1)[0]

        const ra = l.querySelectorAll('.up, .down, .left, .right')

        if (ra.length === 4) {
            const d = document.createElement('div')
            const s = document.createElement('span')
            const c = document.createElement('div')
            const i = document.createElement('div')

            d.classList.add('row')
            s.classList.add('score')
            c.classList.add('correct', 'selected')
            i.classList.add('incorrect')

            c.appendChild(document.createTextNode('0'))
            i.appendChild(document.createTextNode('0'))

            s.appendChild(c)
            s.appendChild(i)
            d.appendChild(s)

            const t = document.getElementById('container')

            t.appendChild(document.createElement('br'))

            t.appendChild(d)
        } else {
            setStatus('Fill the current row before adding another.')
        }
    }

    function removeRow () {
        const ra = Array.from(document.querySelectorAll('.row'))
        const r = ra.slice(-1)[0]

        if (ra.length > 1 && typeof r !== 'undefined') {
            r.remove()

            Array.from(document.getElementById('container').querySelectorAll('br')).slice(-1)[0].remove()
        } else {
            setStatus('Cannot remove the only row.')
        }
    }

    function addArrow (dir) {
        const r = Array.from(document.querySelectorAll('.row')).slice(-1)[0]

        const ra = Array.from(r.querySelectorAll('.up, .down, .left, .right'))

        if(ra.length === 4) {
            const a = ra.slice(-1)[0]

            a.className = ''
            a.classList.add(dir)
        } else {
            const d = document.createElement('div')

            d.classList.add(dir)

            r.appendChild(d)
        }
    }

    function removeArrow () {
        const r = Array.from(document.querySelectorAll('.row')).slice(-1)[0]

        const a = Array.from(r.querySelectorAll('.up, .down, .left, .right')).slice(-1)[0]

        if (typeof a !== 'undefined') {
            a.remove()
        } else {
            setStatus('There is nothing to remove.')
        }
    }

    function helpMe () {
        const d = document.getElementById('directions')
        const h = document.getElementById('help')

        if (d.style.display === 'none') {
            d.style.display = 'block'
            h.style.display = 'none'
        } else {
            d.style.display = 'none'
            h.style.display = 'block'
        }
    }

    function scoreboard () {
        const s = Array.from(document.querySelectorAll('.score')).slice(-1)[0]

        const c = s.children[0]
        const i = s.children[1]

        c.classList.toggle('selected')
        i.classList.toggle('selected')

        setStatus('Changed scoreboard target.')
    }

    function scored (n) {
        const s = Array.from(document.querySelectorAll('.score')).slice(-1)[0]

        const c = s.children[0]
        const i = s.children[1]

        if (c.classList.contains('selected')) {
            c.innerText = n
        } else {
            i.innerText = n
        }

        const sum = parseInt(c.innerText) + parseInt(i.innerText)

        if (sum > 4) {
            setStatus('Error: Sum of scores for a single row must be 4 or less.')
        }
    }

    window.setTimeout(function () {
        document.addEventListener('keyup', function (event) {
            switch (event.code) {
                case 'KeyW':
                case 'ArrowUp':
                    addArrow('up')
                break

                case 'KeyA':
                case 'ArrowLeft':
                    addArrow('left')
                break

                case 'KeyS':
                case 'ArrowDown':
                    addArrow('down')
                break

                case 'KeyD':
                case 'ArrowRight':
                    addArrow('right')
                break

                case 'KeyE':
                case 'Enter':
                    addRow()
                break

                case 'KeyR':
                    removeRow()
                break

                case 'KeyQ':
                    removeArrow()
                break

                case 'Backspace':
                    if (event.ctrlKey) {
                        removeRow()
                    } else {
                        removeArrow()
                    }
                break

                case 'KeyC':
                    scoreboard()
                break

                case 'Digit0':
                case 'Digit1':
                case 'Digit2':
                case 'Digit3':
                case 'Digit4':
                    scored(event.code.slice(-1))
                break

                case 'Digit5':
                    scored(0)
                break

                case 'KeyF':
                    window.location.reload()
                break
            }
        })
    }, 1000)
</script>
</body>
</html>